<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ProjectFlow - Professional Project Management</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>*{margin:0;padding:0;box-sizing:border-box}:root{--primary-blue:#4169E1;--bg-light:#F8F9FC;--text-dark:#1A1D2E;--text-muted:#6B7280;--border-color:#E5E7EB;--white:#FFFFFF;--shadow-sm:0 1px 3px rgba(0,0,0,0.05);--shadow-md:0 4px 12px rgba(0,0,0,0.08);--shadow-lg:0 10px 30px rgba(0,0,0,0.1);--stat-blue-bg:#EBF4FF;--stat-green-bg:#D1FAE5;--stat-orange-bg:#FEF3C7;--stat-purple-bg:#EDE9FE;--green:#22c55e;--yellow:#f59e0b;--red:#ef4444}body{font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg-light);color:var(--text-dark);line-height:1.6}.container{display:flex;min-height:100vh}.sidebar{width:260px;background:var(--white);border-right:1px solid var(--border-color);padding:24px 0;position:fixed;height:100vh;overflow-y:auto;z-index:100}.logo-section{padding:0 24px 24px;border-bottom:1px solid var(--border-color);margin-bottom:24px}.logo{display:flex;align-items:center;gap:12px}.logo-icon{width:40px;height:40px;background:linear-gradient(135deg,var(--primary-blue) 0%,#5B8DEE 100%);border-radius:10px;display:flex;align-items:center;justify-content:center;color:white;font-size:20px;font-weight:700}.logo-text h1{font-family:'Sora',sans-serif;font-size:20px;font-weight:700;color:var(--text-dark)}.logo-text p{font-size:12px;color:var(--text-muted);font-weight:400}.nav-section{padding:0 12px;margin-bottom:32px}.nav-title{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-muted);padding:0 12px;margin-bottom:8px}.nav-item{display:flex;align-items:center;gap:12px;padding:10px 12px;color:var(--text-muted);text-decoration:none;border-radius:8px;margin-bottom:2px;transition:all 0.2s;cursor:pointer}.nav-item:hover{background:var(--bg-light);color:var(--text-dark)}.nav-item.active{background:var(--stat-blue-bg);color:var(--primary-blue);font-weight:600}.nav-icon{width:20px;height:20px;display:flex;align-items:center;justify-content:center}.quick-actions{padding:0 24px}.quick-action-btn{display:flex;align-items:center;gap:10px;width:100%;padding:10px 12px;margin-bottom:6px;background:var(--white);border:1px solid var(--border-color);border-radius:8px;color:var(--text-dark);font-size:14px;cursor:pointer;transition:all 0.2s;user-select:none}.quick-action-btn:hover{border-color:var(--primary-blue);background:var(--stat-blue-bg)}.user-profile{position:absolute;bottom:0;left:0;right:0;padding:16px 24px;border-top:1px solid var(--border-color);display:flex;align-items:center;gap:12px;background:var(--white)}.user-avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#FF6B6B 0%,#EE5A6F 100%);display:flex;align-items:center;justify-content:center;color:white;font-weight:600}.user-name{font-size:14px;font-weight:600;color:var(--text-dark)}.main-content{flex:1;margin-left:260px;padding:32px 40px}.page-content{display:none}.page-content.active{display:block}.header{margin-bottom:32px}.header-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:16px}.header h2{font-family:'Sora',sans-serif;font-size:32px;font-weight:700;color:var(--text-dark)}.header p{font-size:16px;color:var(--text-muted)}.header-actions{display:flex;gap:12px;flex-wrap:wrap}.btn{padding:10px 20px;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;transition:all 0.2s;border:none;display:flex;align-items:center;gap:8px;user-select:none}.btn-secondary{background:var(--white);color:var(--text-dark);border:1px solid var(--border-color)}.btn-secondary:hover{background:var(--bg-light)}.btn-primary{background:var(--primary-blue);color:white}.btn-primary:hover{background:#3557CC;transform:translateY(-1px);box-shadow:var(--shadow-md)}.section-card{background:var(--white);border-radius:12px;padding:28px;box-shadow:var(--shadow-sm);border:1px solid var(--border-color);margin-bottom:24px}.section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;gap:16px}.section-title{font-family:'Sora',sans-serif;font-size:20px;font-weight:700;color:var(--text-dark);display:flex;align-items:center;gap:10px}.empty-state{text-align:center;padding:60px 20px}.empty-icon{font-size:64px;margin-bottom:16px;opacity:0.3}.empty-text{color:var(--text-muted);font-size:15px}.projects-list{display:grid;gap:16px}.project-item{background:var(--white);border:1px solid var(--border-color);border-radius:12px;padding:20px;transition:all 0.3s;cursor:pointer;position:relative}.project-item:hover{box-shadow:var(--shadow-md);transform:translateY(-2px);border-color:var(--primary-blue)}.project-header{display:flex;justify-content:space-between;align-items:start;margin-bottom:12px;gap:12px}.project-name{font-family:'Sora',sans-serif;font-size:18px;font-weight:700;color:var(--text-dark);margin-bottom:4px}.project-client{font-size:14px;color:var(--text-muted)}.project-status{padding:4px 12px;border-radius:6px;font-size:12px;font-weight:600;text-transform:uppercase;white-space:nowrap}.status-active{background:var(--stat-green-bg);color:#10B981}.status-pending{background:var(--stat-orange-bg);color:#F59E0B}.status-completed{background:var(--stat-blue-bg);color:var(--primary-blue)}.project-description{color:var(--text-muted);font-size:14px;margin-bottom:16px;line-height:1.6}.project-meta{display:flex;gap:20px;margin-bottom:12px;font-size:13px;flex-wrap:wrap}.meta-item{display:flex;align-items:center;gap:6px;color:var(--text-muted)}.progress-bar{height:8px;background:var(--bg-light);border-radius:4px;overflow:hidden}.progress-fill{height:100%;background:linear-gradient(90deg,var(--primary-blue) 0%,#5B8DEE 100%);transition:width 0.3s}.project-progress{margin-top:12px}.progress-info{display:flex;justify-content:space-between;font-size:13px;margin-bottom:6px}.progress-tasks{color:var(--text-dark);font-weight:600}.progress-percent{color:var(--text-muted)}.filters-bar{display:flex;gap:12px;margin-bottom:24px;flex-wrap:wrap}.filter-btn{padding:8px 16px;border:1px solid var(--border-color);background:var(--white);border-radius:8px;font-size:14px;cursor:pointer;transition:all 0.2s;user-select:none}.filter-btn:hover{border-color:var(--primary-blue);background:var(--stat-blue-bg)}.filter-btn.active{background:var(--primary-blue);color:white;border-color:var(--primary-blue)}.task-row{display:flex;gap:14px;align-items:flex-start}.task-check{margin-top:2px;width:18px;height:18px;cursor:pointer}.task-title{font-weight:700;color:var(--text-dark);margin-bottom:4px}.task-title.completed{text-decoration:line-through;color:var(--text-muted)}.task-badges{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}.badge{font-size:12px;font-weight:600;padding:4px 10px;border-radius:999px;border:1px solid var(--border-color);background:var(--bg-light);color:var(--text-dark)}.badge.due-today{background:var(--stat-orange-bg);border-color:#FCD34D}.badge.overdue{background:#FEE2E2;border-color:#FCA5A5;color:#B91C1C}.badge.project{background:var(--stat-blue-bg);border-color:#BFDBFE;color:var(--primary-blue)}.task-actions{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}.icon-btn{border:1px solid var(--border-color);background:var(--white);border-radius:8px;padding:6px 10px;cursor:pointer;font-weight:600;font-size:13px;transition:all 0.2s;display:inline-flex;align-items:center;gap:6px;user-select:none}.icon-btn:hover{border-color:var(--primary-blue);background:var(--stat-blue-bg)}.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:none;align-items:center;justify-content:center;padding:24px;z-index:9999}.modal-backdrop.show{display:flex}.modal{width:min(680px,100%);max-height:90vh;overflow-y:auto;background:var(--white);border:1px solid var(--border-color);border-radius:14px;box-shadow:var(--shadow-lg);padding:24px}.modal h3{font-family:'Sora',sans-serif;font-size:20px;margin-bottom:20px}.modal .row{display:grid;gap:12px;grid-template-columns:1fr 1fr;margin-bottom:12px}.modal label{font-size:12px;color:var(--text-muted);font-weight:600;display:block;margin-bottom:6px}.modal input,.modal select,.modal textarea{width:100%;padding:10px 12px;border:1px solid var(--border-color);border-radius:8px;background:var(--white);font-family:inherit}.modal textarea{min-height:80px;resize:vertical}.modal-footer{display:flex;justify-content:flex-end;gap:10px;margin-top:20px;flex-wrap:wrap}.kanban-board{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-top:20px}.kanban-column{background:var(--bg-light);border-radius:12px;padding:16px;min-height:400px}.kanban-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid var(--border-color)}.kanban-title{font-family:'Sora',sans-serif;font-size:16px;font-weight:700;display:flex;align-items:center;gap:8px}.kanban-count{background:var(--white);padding:4px 10px;border-radius:12px;font-size:12px;font-weight:600;color:var(--text-muted)}.kanban-tasks{display:flex;flex-direction:column;gap:12px}.kanban-task{background:var(--white);border:1px solid var(--border-color);border-radius:10px;padding:14px;cursor:move;transition:all 0.2s}.kanban-task:hover{box-shadow:var(--shadow-md);transform:translateY(-2px)}.kanban-task.dragging{opacity:0.5}.kanban-task-title{font-weight:600;margin-bottom:8px;color:var(--text-dark)}.kanban-task-meta{display:flex;gap:12px;font-size:12px;color:var(--text-muted);flex-wrap:wrap}.gantt-container{overflow-x:auto;margin-top:20px}.gantt-chart{min-width:100%;background:var(--white);border-radius:12px;padding:20px}.gantt-header{display:grid;grid-template-columns:250px 1fr;gap:20px;margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid var(--border-color)}.gantt-timeline{display:flex;gap:2px}.gantt-month{flex:1;text-align:center;font-size:12px;font-weight:600;color:var(--text-muted);padding:8px 4px;background:var(--bg-light);border-radius:6px}.gantt-row{display:grid;grid-template-columns:250px 1fr;gap:20px;margin-bottom:12px;padding:12px 0;border-bottom:1px solid var(--border-color)}.gantt-project-name{font-weight:600;color:var(--text-dark);display:flex;align-items:center}.gantt-bar-container{position:relative;height:32px}.gantt-bar{position:absolute;height:100%;background:linear-gradient(135deg,var(--primary-blue) 0%,#5B8DEE 100%);border-radius:6px;display:flex;align-items:center;padding:0 12px;color:white;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s}.gantt-bar:hover{box-shadow:var(--shadow-md);transform:translateY(-2px)}.gantt-milestone{position:absolute;width:16px;height:16px;background:var(--yellow);border:3px solid var(--white);border-radius:50%;top:50%;transform:translate(-50%,-50%);cursor:pointer;box-shadow:var(--shadow-sm);z-index:10}.gantt-milestone:hover{transform:translate(-50%,-50%) scale(1.2)}.milestone-item{background:var(--white);border:2px solid var(--yellow);border-radius:12px;padding:16px;margin-bottom:12px;transition:all 0.3s}.milestone-item:hover{box-shadow:var(--shadow-md);transform:translateY(-2px)}.milestone-header{display:flex;justify-content:space-between;align-items:start;margin-bottom:8px}.milestone-name{font-weight:700;color:var(--text-dark);display:flex;align-items:center;gap:8px}.milestone-status{padding:4px 10px;border-radius:6px;font-size:11px;font-weight:600;text-transform:uppercase}.milestone-status.completed{background:var(--stat-green-bg);color:#10B981}.milestone-status.pending{background:var(--stat-orange-bg);color:#F59E0B}.milestone-description{color:var(--text-muted);font-size:14px;margin-bottom:12px}@media (max-width:980px){.kanban-board{grid-template-columns:1fr}}@media (max-width:768px){.sidebar{transform:translateX(-100%)}.main-content{margin-left:0;padding:20px}}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.section-card,.project-item{animation:fadeIn 0.5s ease-out}</style>
</head>
<body>
<div class="container">
<aside class="sidebar">
<div class="logo-section">
<div class="logo">
<div class="logo-icon">âœ“</div>
<div class="logo-text">
<h1>ProjectFlow</h1>
<p>Professional Project<br/>Management</p>
</div>
</div>
</div>
<nav>
<div class="nav-section">
<div class="nav-title">Navigation</div>
<a href="#" class="nav-item active" data-page="dashboard"><span class="nav-icon">ğŸ“Š</span><span>Dashboard</span></a>
<a href="#" class="nav-item" data-page="summary"><span class="nav-icon">ğŸ“‹</span><span>Summary</span></a>
<a href="#" class="nav-item" data-page="projects"><span class="nav-icon">ğŸ“</span><span>Projects</span></a>
<a href="#" class="nav-item" data-page="tasks"><span class="nav-icon">âœ…</span><span>Tasks</span></a>
<a href="#" class="nav-item" data-page="kanban"><span class="nav-icon">ğŸ“Œ</span><span>Kanban Board</span></a>
<a href="#" class="nav-item" data-page="gantt"><span class="nav-icon">ğŸ“…</span><span>Gantt Chart</span></a>
<a href="#" class="nav-item" data-page="milestones"><span class="nav-icon">ğŸ¯</span><span>Milestones</span></a>
</div>
<div class="nav-section">
<div class="nav-title">Quick Actions</div>
<div class="quick-actions">
<button class="quick-action-btn" id="qa-new-project"><span>â•</span><span>New Project</span></button>
<button class="quick-action-btn" id="qa-new-task"><span>âœ…</span><span>New Task</span></button>
<button class="quick-action-btn" id="qa-new-milestone"><span>ğŸ¯</span><span>New Milestone</span></button>
</div>
</div>
</nav>
<div class="user-profile">
<div class="user-avatar">U</div>
<div class="user-info">
<div class="user-name">User</div>
</div>
</div>
</aside>
<main class="main-content">
<div class="page-content active" id="dashboard-page">
<div class="header">
<div class="header-top">
<div><h2>Dashboard</h2><p>Overview of all projects</p></div>
<div class="header-actions">
<button class="btn btn-primary" id="new-project-btn-dash"><span>â•</span><span>New Project</span></button>
</div>
</div>
</div>
<div id="dashboard-stats"></div>
<div class="section-card">
<div class="section-header">
<h3 class="section-title"><span>ğŸ“Š</span><span>All Projects</span></h3>
</div>
<div id="dashboard-projects"></div>
</div>
</div>

<div class="page-content" id="summary-page">
<div class="header">
<div class="header-top">
<div><h2>Summary</h2><p>Project overview</p></div>
<div class="header-actions">
<button class="btn btn-primary" id="summary-new-btn"><span>â•</span><span>New Project</span></button>
</div>
</div>
</div>
<div class="filters-bar" id="summary-filters">
<button class="filter-btn active" data-filter="all">All</button>
<button class="filter-btn" data-filter="active">Active</button>
<button class="filter-btn" data-filter="pending">Pending</button>
<button class="filter-btn" data-filter="completed">Completed</button>
</div>
<div class="section-card">
<div class="projects-list" id="summary-projects"></div>
</div>
</div>

<div class="page-content" id="projects-page">
<div class="header">
<div class="header-top">
<div><h2>Projects</h2><p>Manage your projects</p></div>
<div class="header-actions">
<button class="btn btn-primary" id="projects-new-btn"><span>â•</span><span>New Project</span></button>
</div>
</div>
</div>
<div class="filters-bar" id="projects-filters">
<button class="filter-btn active" data-project-filter="all">All</button>
<button class="filter-btn" data-project-filter="active">Active</button>
<button class="filter-btn" data-project-filter="pending">Pending</button>
<button class="filter-btn" data-project-filter="completed">Completed</button>
</div>
<div class="section-card">
<div class="projects-list" id="projects-list"></div>
</div>
</div>

<div class="page-content" id="tasks-page">
<div class="header">
<div class="header-top">
<div><h2>Tasks</h2><p id="tasks-subtitle">Manage your tasks</p></div>
<div class="header-actions">
<button class="btn btn-secondary" id="clear-completed"><span>ğŸ§¹</span><span>Clear Completed</span></button>
<button class="btn btn-secondary" id="clear-filter" style="display:none"><span>â†©ï¸</span><span>Show All</span></button>
</div>
</div>
</div>
<div class="section-card">
<h3 class="section-title"><span>â•</span><span>Add Task</span></h3>
<form id="task-form" style="display:grid;gap:12px;grid-template-columns:1fr 180px 200px 120px;align-items:end;margin-top:16px">
<div><label style="font-size:12px;color:var(--text-muted);font-weight:600;margin-bottom:6px;display:block">Task name</label>
<input id="task-name" required placeholder="Task name" style="width:100%;padding:10px 12px;border:1px solid var(--border-color);border-radius:8px"></div>
<div><label style="font-size:12px;color:var(--text-muted);font-weight:600;margin-bottom:6px;display:block">Due date</label>
<input id="task-due" type="date" required style="width:100%;padding:10px 12px;border:1px solid var(--border-color);border-radius:8px"></div>
<div><label style="font-size:12px;color:var(--text-muted);font-weight:600;margin-bottom:6px;display:block">Project</label>
<select id="task-project" style="width:100%;padding:10px 12px;border:1px solid var(--border-color);border-radius:8px"></select></div>
<button class="btn btn-primary" type="submit" style="justify-content:center"><span>â•</span><span>Add</span></button>
</form>
</div>
<div class="filters-bar" id="tasks-filters">
<button class="filter-btn active" data-task-filter="all">All</button>
<button class="filter-btn" data-task-filter="open">Open</button>
<button class="filter-btn" data-task-filter="completed">Completed</button>
<button class="filter-btn" data-task-filter="overdue">Overdue</button>
</div>
<div class="section-card">
<div class="projects-list" id="tasks-list"></div>
</div>
</div>

<div class="page-content" id="kanban-page">
<div class="header">
<div class="header-top">
<div><h2>Kanban Board</h2><p>Drag and drop tasks</p></div>
</div>
</div>
<div class="section-card">
<div class="kanban-board">
<div class="kanban-column" data-status="todo">
<div class="kanban-header">
<div class="kanban-title">ğŸ“‹ To Do</div>
<div class="kanban-count" id="count-todo">0</div>
</div>
<div class="kanban-tasks" id="kanban-todo"></div>
</div>
<div class="kanban-column" data-status="inprogress">
<div class="kanban-header">
<div class="kanban-title">ğŸ”„ In Progress</div>
<div class="kanban-count" id="count-inprogress">0</div>
</div>
<div class="kanban-tasks" id="kanban-inprogress"></div>
</div>
<div class="kanban-column" data-status="review">
<div class="kanban-header">
<div class="kanban-title">ğŸ‘€ Review</div>
<div class="kanban-count" id="count-review">0</div>
</div>
<div class="kanban-tasks" id="kanban-review"></div>
</div>
<div class="kanban-column" data-status="done">
<div class="kanban-header">
<div class="kanban-title">âœ… Done</div>
<div class="kanban-count" id="count-done">0</div>
</div>
<div class="kanban-tasks" id="kanban-done"></div>
</div>
</div>
</div>
</div>

<div class="page-content" id="gantt-page">
<div class="header">
<div class="header-top">
<div><h2>Gantt Chart</h2><p>Project timeline</p></div>
</div>
</div>
<div class="section-card">
<div class="gantt-container" id="gantt-container"></div>
</div>
</div>

<div class="page-content" id="milestones-page">
<div class="header">
<div class="header-top">
<div><h2>Milestones</h2><p>Track key achievements</p></div>
<div class="header-actions">
<button class="btn btn-primary" id="milestones-new-btn"><span>â•</span><span>New Milestone</span></button>
</div>
</div>
</div>
<div class="section-card">
<div id="milestones-list"></div>
</div>
</div>

</main>
</div>

<div class="modal-backdrop" id="project-modal">
<div class="modal">
<h3 id="project-modal-title">New Project</h3>
<div style="margin-bottom:12px"><label>Project name</label><input id="pm-name" placeholder="Project name"/></div>
<div class="row">
<div><label>Client</label><input id="pm-client" placeholder="Client name"/></div>
<div><label>Status</label><select id="pm-status">
<option value="active">Active</option>
<option value="pending">Pending</option>
<option value="completed">Completed</option>
</select></div>
</div>
<div class="row">
<div><label>Start date</label><input id="pm-start" type="date"/></div>
<div><label>Due date</label><input id="pm-due" type="date"/></div>
</div>
<div class="row">
<div><label>Budget</label><input id="pm-budget" placeholder="$0"/></div>
<div><label>Progress</label><input id="pm-progress" type="number" min="0" max="100" placeholder="0"/></div>
</div>
<div style="margin-bottom:12px"><label>Description</label><textarea id="pm-desc" placeholder="Description"></textarea></div>
<div class="modal-footer">
<button class="btn btn-secondary" id="pm-cancel"><span>âœ–</span><span>Cancel</span></button>
<button class="btn btn-primary" id="pm-save"><span>ğŸ’¾</span><span>Save</span></button>
</div>
</div>
</div>

<div class="modal-backdrop" id="task-modal">
<div class="modal">
<h3 id="task-modal-title">Edit Task</h3>
<div style="margin-bottom:12px"><label>Task name</label><input id="tm-name"/></div>
<div class="row">
<div><label>Due date</label><input id="tm-due" type="date"/></div>
<div><label>Project</label><select id="tm-project"></select></div>
</div>
<div style="margin-bottom:12px"><label>Status</label><select id="tm-status">
<option value="todo">To Do</option>
<option value="inprogress">In Progress</option>
<option value="review">Review</option>
<option value="done">Done</option>
</select></div>
<div class="modal-footer">
<button class="btn btn-secondary" id="tm-cancel"><span>âœ–</span><span>Cancel</span></button>
<button class="btn btn-primary" id="tm-save"><span>ğŸ’¾</span><span>Save</span></button>
</div>
</div>
</div>

<div class="modal-backdrop" id="milestone-modal">
<div class="modal">
<h3 id="milestone-modal-title">New Milestone</h3>
<div style="margin-bottom:12px"><label>Milestone name</label><input id="mm-name" placeholder="Milestone name"/></div>
<div class="row">
<div><label>Project</label><select id="mm-project"></select></div>
<div><label>Due date</label><input id="mm-due" type="date"/></div>
</div>
<div style="margin-bottom:12px"><label>Status</label><select id="mm-status">
<option value="pending">Pending</option>
<option value="completed">Completed</option>
</select></div>
<div style="margin-bottom:12px"><label>Description</label><textarea id="mm-desc" placeholder="Description"></textarea></div>
<div class="modal-footer">
<button class="btn btn-secondary" id="mm-cancel"><span>âœ–</span><span>Cancel</span></button>
<button class="btn btn-primary" id="mm-save"><span>ğŸ’¾</span><span>Save</span></button>
</div>
</div>
</div>

<script>
const LS={projects:"pf_proj_v3",tasks:"pf_tasks_v3",milestones:"pf_miles_v3"};
function load(k,d){try{const r=localStorage.getItem(k);return r?JSON.parse(r):d}catch{return d}}
function save(k,v){localStorage.setItem(k,JSON.stringify(v))}
let projects=load(LS.projects,[]),tasks=load(LS.tasks,[]),milestones=load(LS.milestones,[]),currentProjectFilter=null,editingProject=null,editingTask=null,editingMilestone=null,draggedTask=null;
function persist(){save(LS.projects,projects);save(LS.tasks,tasks);save(LS.milestones,milestones)}
function today(){const d=new Date();return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`}
function fmt(d){if(!d)return'â€”';return new Date(d).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})}
function safe(v){return(v??'').toString()}
function validate(){if(!Array.isArray(projects))projects=[];if(!Array.isArray(tasks))tasks=[];if(!Array.isArray(milestones))milestones=[];const pids=new Set(projects.map(p=>p.id));tasks=tasks.filter(t=>pids.has(t.projectId));milestones=milestones.filter(m=>pids.has(m.projectId))}

function showPage(p){document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));const n=document.querySelector(`.nav-item[data-page="${p}"]`);if(n)n.classList.add('active');document.querySelectorAll('.page-content').forEach(pc=>pc.classList.remove('active'));const t=document.getElementById(`${p}-page`);if(t)t.classList.add('active');if(p==='dashboard')renderDashboard();if(p==='summary')renderSummary();if(p==='projects')renderProjects();if(p==='tasks')renderTasks();if(p==='kanban')renderKanban();if(p==='gantt')renderGantt();if(p==='milestones')renderMilestones()}

document.querySelectorAll('.nav-item').forEach(i=>i.addEventListener('click',function(e){e.preventDefault();const p=this.getAttribute('data-page');if(p)showPage(p)}));

function renderDashboard(){const c=document.getElementById('dashboard-stats');if(!c)return;const total=projects.length,active=projects.filter(p=>p.status==='active').length,completed=projects.filter(p=>p.status==='completed').length,pending=projects.filter(p=>p.status==='pending').length;c.innerHTML=`<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:24px">
<div class="section-card" style="padding:20px"><div style="font-size:13px;font-weight:600;color:var(--text-muted);text-transform:uppercase;margin-bottom:8px">Total</div><div style="font-size:32px;font-weight:700;font-family:'Sora'">${total}</div></div>
<div class="section-card" style="padding:20px"><div style="font-size:13px;font-weight:600;color:var(--text-muted);text-transform:uppercase;margin-bottom:8px">Active</div><div style="font-size:32px;font-weight:700;font-family:'Sora';color:#10B981">${active}</div></div>
<div class="section-card" style="padding:20px"><div style="font-size:13px;font-weight:600;color:var(--text-muted);text-transform:uppercase;margin-bottom:8px">Completed</div><div style="font-size:32px;font-weight:700;font-family:'Sora';color:var(--primary-blue)">${completed}</div></div>
<div class="section-card" style="padding:20px"><div style="font-size:13px;font-weight:600;color:var(--text-muted);text-transform:uppercase;margin-bottom:8px">Pending</div><div style="font-size:32px;font-weight:700;font-family:'Sora';color:#F59E0B">${pending}</div></div>
</div>`;const dp=document.getElementById('dashboard-projects');if(!dp)return;if(projects.length===0){dp.innerHTML='<div class="empty-state"><div class="empty-icon">ğŸ“</div><div class="empty-text">No projects yet. Click "New Project" to get started!</div></div>';return}dp.innerHTML=projects.map(p=>{const t=tasks.filter(tk=>tk.projectId===p.id),done=t.filter(tk=>tk.completed).length,total=t.length,pct=total?Math.round((done/total)*100):0;return`<div class="project-item" data-project-id="${p.id}"><div class="project-header"><div><div class="project-name">${safe(p.name)}</div><div class="project-client">ğŸ‘¤ ${safe(p.client)}</div></div><div class="project-status status-${p.status}">${p.status.toUpperCase()}</div></div><div class="project-description">${safe(p.description)}</div><div class="project-meta"><div class="meta-item"><span>ğŸ“…</span><span>Due: ${fmt(p.dueDate)}</span></div><div class="meta-item"><span>ğŸ’°</span><span>${safe(p.budget)||'â€”'}</span></div></div><div class="project-progress"><div class="progress-info"><span class="progress-tasks">Tasks: ${done}/${total}</span><span class="progress-percent">${pct}%</span></div><div class="progress-bar"><div class="progress-fill" style="width:${pct}%"></div></div></div><div class="task-actions"><button class="icon-btn" data-action="view-tasks"><span>âœ…</span><span>View Tasks</span></button></div></div>`}).join('')}

function renderSummary(){const f=document.querySelector('#summary-filters .filter-btn.active');const filter=f?f.getAttribute('data-filter'):'all';const c=document.getElementById('summary-projects');if(!c)return;const list=filter==='all'?projects:projects.filter(p=>p.status===filter);if(!list.length){c.innerHTML='<div class="empty-state"><div class="empty-icon">ğŸ“</div><div class="empty-text">No projects found</div></div>';return}c.innerHTML=list.map(p=>{const t=tasks.filter(tk=>tk.projectId===p.id),done=t.filter(tk=>tk.completed).length,total=t.length,pct=total?Math.round((done/total)*100):0;return`<div class="project-item" data-project-id="${p.id}"><div class="project-header"><div><div class="project-name">${safe(p.name)}</div><div class="project-client">ğŸ‘¤ ${safe(p.client)}</div></div><div class="project-status status-${p.status}">${p.status.toUpperCase()}</div></div><div class="project-description">${safe(p.description)}</div><div class="project-meta"><div class="meta-item"><span>ğŸ“…</span><span>Due: ${fmt(p.dueDate)}</span></div><div class="meta-item"><span>ğŸ’°</span><span>${safe(p.budget)||'â€”'}</span></div></div><div class="project-progress"><div class="progress-info"><span class="progress-tasks">Tasks: ${done}/${total}</span><span class="progress-percent">${pct}%</span></div><div class="progress-bar"><div class="progress-fill" style="width:${pct}%"></div></div></div><div class="task-actions"><button class="icon-btn" data-action="view-tasks"><span>âœ…</span><span>View Tasks</span></button></div></div>`}).join('')}

function renderProjects(){const f=document.querySelector('#projects-filters .filter-btn.active[data-project-filter]');const filter=f?f.getAttribute('data-project-filter'):'all';const c=document.getElementById('projects-list');if(!c)return;const list=filter==='all'?projects:projects.filter(p=>p.status===filter);if(!list.length){c.innerHTML='<div class="empty-state"><div class="empty-icon">ğŸ“</div><div class="empty-text">No projects found. Click "New Project" to create one!</div></div>';return}c.innerHTML=list.map(p=>{const t=tasks.filter(tk=>tk.projectId===p.id),done=t.filter(tk=>tk.completed).length,total=t.length,pct=total?Math.round((done/total)*100):0;return`<div class="project-item" data-project-id="${p.id}"><div class="project-header"><div><div class="project-name">${safe(p.name)}</div><div class="project-client">ğŸ‘¤ ${safe(p.client)||'â€”'}</div></div><div class="project-status status-${p.status}">${p.status.toUpperCase()}</div></div><div class="project-description">${safe(p.description)}</div><div class="project-meta"><div class="meta-item"><span>ğŸ“…</span><span>Due: ${fmt(p.dueDate)}</span></div><div class="meta-item"><span>ğŸ’°</span><span>${safe(p.budget)||'â€”'}</span></div></div><div class="project-progress"><div class="progress-info"><span class="progress-tasks">Tasks: ${done}/${total}</span><span class="progress-percent">${pct}%</span></div><div class="progress-bar"><div class="progress-fill" style="width:${pct}%"></div></div></div><div class="task-actions"><button class="icon-btn" data-project-edit><span>âœï¸</span><span>Edit</span></button><button class="icon-btn" data-project-delete><span>ğŸ—‘ï¸</span><span>Delete</span></button><button class="icon-btn" data-action="view-tasks"><span>âœ…</span><span>View Tasks</span></button></div></div>`}).join('')}

function populateProjectDrops(){const sels=[document.getElementById('task-project'),document.getElementById('tm-project'),document.getElementById('mm-project')].filter(Boolean);if(!projects.length){sels.forEach(s=>s.innerHTML='<option value="">No projects</option>');return}const opts=projects.map(p=>`<option value="${p.id}">${safe(p.name)}</option>`).join('');sels.forEach(s=>s.innerHTML=opts)}

function renderTasks(){populateProjectDrops();const f=document.querySelector('#tasks-filters .filter-btn.active[data-task-filter]');const filter=f?f.getAttribute('data-task-filter'):'all';const c=document.getElementById('tasks-list');if(!c)return;let list=[...tasks];if(currentProjectFilter)list=list.filter(t=>t.projectId===currentProjectFilter);if(filter==='open')list=list.filter(t=>!t.completed);if(filter==='completed')list=list.filter(t=>t.completed);if(filter==='overdue')list=list.filter(t=>!t.completed&&t.dueDate<today());if(!list.length){c.innerHTML='<div class="empty-state"><div class="empty-icon">âœ…</div><div class="empty-text">No tasks found. Add a task to get started!</div></div>';return}c.innerHTML=list.sort((a,b)=>a.dueDate>b.dueDate?1:-1).map(t=>{const p=projects.find(pr=>pr.id===t.projectId);const badges=[];badges.push(`<span class="badge project">ğŸ“ ${p?safe(p.name):'Unassigned'}</span>`);if(t.dueDate===today()&&!t.completed)badges.push('<span class="badge due-today">ğŸ“… Due today</span>');if(!t.completed&&t.dueDate<today())badges.push('<span class="badge overdue">âš ï¸ Overdue</span>');return`<div class="project-item" data-task-id="${t.id}"><div class="task-row"><input class="task-check" type="checkbox" ${t.completed?'checked':''}/>
<div style="flex:1"><div class="task-title ${t.completed?'completed':''}">${safe(t.title)}</div><div class="project-meta" style="margin:0"><div class="meta-item"><span>ğŸ“…</span><span>Due: ${fmt(t.dueDate)}</span></div></div><div class="task-badges">${badges.join('')}</div><div class="task-actions"><button class="icon-btn" data-task-edit><span>âœï¸</span><span>Edit</span></button><button class="icon-btn" data-task-delete><span>ğŸ—‘ï¸</span><span>Delete</span></button></div></div></div></div>`}).join('')}

function renderKanban(){['todo','inprogress','review','done'].forEach(st=>{const c=document.getElementById(`kanban-${st}`),cnt=document.getElementById(`count-${st}`);if(!c)return;const list=tasks.filter(t=>(t.kanbanStatus||'todo')===st);if(cnt)cnt.textContent=list.length;if(!list.length){c.innerHTML='<div style="text-align:center;color:var(--text-muted);padding:20px;font-size:14px">No tasks</div>';return}c.innerHTML=list.map(t=>{const p=projects.find(pr=>pr.id===t.projectId);return`<div class="kanban-task" draggable="true" data-task-id="${t.id}"><div class="kanban-task-title">${safe(t.title)}</div><div class="kanban-task-meta"><span>ğŸ“ ${p?safe(p.name):'Unassigned'}</span><span>ğŸ“… ${fmt(t.dueDate)}</span></div></div>`}).join('');c.querySelectorAll('.kanban-task').forEach(el=>{el.addEventListener('dragstart',e=>{draggedTask=Number(el.getAttribute('data-task-id'));el.classList.add('dragging')});el.addEventListener('dragend',()=>el.classList.remove('dragging'))})});document.querySelectorAll('.kanban-tasks').forEach(col=>{col.addEventListener('dragover',e=>e.preventDefault());col.addEventListener('drop',e=>{e.preventDefault();const newStatus=col.parentElement.getAttribute('data-status');if(!draggedTask||!newStatus)return;tasks=tasks.map(t=>t.id===draggedTask?{...t,kanbanStatus:newStatus}:t);persist();renderKanban();draggedTask=null})})}

function renderGantt(){const c=document.getElementById('gantt-container');if(!c)return;if(!projects.length){c.innerHTML='<div class="empty-state"><div class="empty-icon">ğŸ“…</div><div class="empty-text">No projects to display</div></div>';return}const dates=[];projects.forEach(p=>{if(p.startDate)dates.push(new Date(p.startDate));if(p.dueDate)dates.push(new Date(p.dueDate))});milestones.forEach(m=>{if(m.dueDate)dates.push(new Date(m.dueDate))});if(!dates.length){c.innerHTML='<div style="padding:40px;text-align:center;color:var(--text-muted)">No dates set</div>';return}const minDate=new Date(Math.min(...dates)),maxDate=new Date(Math.max(...dates)),months=[];let curr=new Date(minDate.getFullYear(),minDate.getMonth(),1),end=new Date(maxDate.getFullYear(),maxDate.getMonth(),1);while(curr<=end){months.push({label:curr.toLocaleDateString('en-US',{month:'short',year:'numeric'}),date:new Date(curr)});curr.setMonth(curr.getMonth()+1)}const totalDays=Math.ceil((maxDate-minDate)/(1000*60*60*24))+30;let html=`<div class="gantt-chart"><div class="gantt-header"><div style="font-weight:600">Project</div><div class="gantt-timeline">${months.map(m=>`<div class="gantt-month">${m.label}</div>`).join('')}</div></div>`;projects.forEach(p=>{const start=p.startDate?new Date(p.startDate):minDate,due=p.dueDate?new Date(p.dueDate):maxDate,startOff=((start-minDate)/(1000*60*60*24))/totalDays*100,dur=((due-start)/(1000*60*60*24))/totalDays*100;const pMiles=milestones.filter(m=>m.projectId===p.id);html+=`<div class="gantt-row"><div class="gantt-project-name">${safe(p.name)}</div><div class="gantt-bar-container"><div class="gantt-bar" style="left:${startOff}%;width:${dur}%" title="${p.name}
${fmt(start)} - ${fmt(due)}">${dur>5?safe(p.name).substring(0,20):''}</div>${pMiles.map(ms=>{const msDate=new Date(ms.dueDate),msOff=((msDate-minDate)/(1000*60*60*24))/totalDays*100;return`<div class="gantt-milestone" style="left:${msOff}%" title="${safe(ms.name)} - ${fmt(ms.dueDate)}"></div>`}).join('')}</div></div>`});html+='</div>';c.innerHTML=html}

function renderMilestones(){populateProjectDrops();const c=document.getElementById('milestones-list');if(!c)return;if(!milestones.length){c.innerHTML='<div class="empty-state"><div class="empty-icon">ğŸ¯</div><div class="empty-text">No milestones yet. Click "New Milestone" to create one!</div></div>';return}c.innerHTML=milestones.sort((a,b)=>a.dueDate>b.dueDate?1:-1).map(m=>{const p=projects.find(pr=>pr.id===m.projectId);return`<div class="milestone-item" data-milestone-id="${m.id}"><div class="milestone-header"><div class="milestone-name"><span>ğŸ¯</span><span>${safe(m.name)}</span></div><div class="milestone-status ${m.status}">${m.status.toUpperCase()}</div></div><div class="milestone-description">${safe(m.description)}</div><div class="project-meta" style="margin-bottom:12px"><div class="meta-item"><span>ğŸ“</span><span>${p?safe(p.name):'No project'}</span></div><div class="meta-item"><span>ğŸ“…</span><span>Due: ${fmt(m.dueDate)}</span></div></div><div class="task-actions"><button class="icon-btn" data-milestone-edit><span>âœï¸</span><span>Edit</span></button><button class="icon-btn" data-milestone-delete><span>ğŸ—‘ï¸</span><span>Delete</span></button><button class="icon-btn" data-milestone-toggle><span>${m.status==='completed'?'â†©ï¸':'âœ“'}</span><span>${m.status==='completed'?'Reopen':'Complete'}</span></button></div></div>`}).join('')}

function openProjectModal(id=null){if(id){editingProject=id;const p=projects.find(x=>x.id===id);if(!p)return;document.getElementById('project-modal-title').textContent='Edit Project';document.getElementById('pm-name').value=p.name||'';document.getElementById('pm-client').value=p.client||'';document.getElementById('pm-status').value=p.status||'active';document.getElementById('pm-start').value=p.startDate||'';document.getElementById('pm-due').value=p.dueDate||'';document.getElementById('pm-budget').value=p.budget||'';document.getElementById('pm-progress').value=p.progress||0;document.getElementById('pm-desc').value=p.description||''}else{editingProject=null;document.getElementById('project-modal-title').textContent='New Project';document.getElementById('pm-name').value='';document.getElementById('pm-client').value='';document.getElementById('pm-status').value='active';document.getElementById('pm-start').value='';document.getElementById('pm-due').value='';document.getElementById('pm-budget').value='';document.getElementById('pm-progress').value='0';document.getElementById('pm-desc').value=''}document.getElementById('project-modal').classList.add('show')}
function closeProjectModal(){document.getElementById('project-modal').classList.remove('show');editingProject=null}

function openTaskModal(id){editingTask=id;const t=tasks.find(x=>x.id===id);if(!t)return;populateProjectDrops();document.getElementById('task-modal-title').textContent='Edit Task';document.getElementById('tm-name').value=t.title||'';document.getElementById('tm-due').value=t.dueDate||'';document.getElementById('tm-project').value=String(t.projectId);document.getElementById('tm-status').value=t.kanbanStatus||'todo';document.getElementById('task-modal').classList.add('show')}
function closeTaskModal(){document.getElementById('task-modal').classList.remove('show');editingTask=null}

function openMilestoneModal(id=null){if(!projects.length){alert('Please create a project first');return}populateProjectDrops();if(id){editingMilestone=id;const m=milestones.find(x=>x.id===id);if(!m)return;document.getElementById('milestone-modal-title').textContent='Edit Milestone';document.getElementById('mm-name').value=m.name||'';document.getElementById('mm-project').value=String(m.projectId);document.getElementById('mm-due').value=m.dueDate||'';document.getElementById('mm-status').value=m.status||'pending';document.getElementById('mm-desc').value=m.description||''}else{editingMilestone=null;document.getElementById('milestone-modal-title').textContent='New Milestone';document.getElementById('mm-name').value='';document.getElementById('mm-due').value='';document.getElementById('mm-status').value='pending';document.getElementById('mm-desc').value=''}document.getElementById('milestone-modal').classList.add('show')}
function closeMilestoneModal(){document.getElementById('milestone-modal').classList.remove('show');editingMilestone=null}

document.getElementById('pm-cancel').addEventListener('click',closeProjectModal);
document.getElementById('project-modal').addEventListener('click',e=>{if(e.target.id==='project-modal')closeProjectModal()});
document.getElementById('pm-save').addEventListener('click',()=>{const name=document.getElementById('pm-name').value.trim();if(!name)return alert('Project name required');const payload={name,client:document.getElementById('pm-client').value.trim(),status:document.getElementById('pm-status').value,startDate:document.getElementById('pm-start').value,dueDate:document.getElementById('pm-due').value,budget:document.getElementById('pm-budget').value.trim(),progress:Number(document.getElementById('pm-progress').value||0),description:document.getElementById('pm-desc').value.trim()};if(editingProject){projects=projects.map(p=>p.id===editingProject?{...p,...payload}:p)}else{projects.unshift({id:Date.now(),...payload})}persist();closeProjectModal();populateProjectDrops();renderDashboard();renderSummary();renderProjects();renderGantt()});

document.getElementById('tm-cancel').addEventListener('click',closeTaskModal);
document.getElementById('task-modal').addEventListener('click',e=>{if(e.target.id==='task-modal')closeTaskModal()});
document.getElementById('tm-save').addEventListener('click',()=>{const name=document.getElementById('tm-name').value.trim();if(!name)return alert('Task name required');tasks=tasks.map(t=>t.id===editingTask?{...t,title:name,dueDate:document.getElementById('tm-due').value,projectId:Number(document.getElementById('tm-project').value),kanbanStatus:document.getElementById('tm-status').value}:t);persist();closeTaskModal();renderTasks();renderKanban();renderDashboard();renderSummary();renderProjects()});

document.getElementById('mm-cancel').addEventListener('click',closeMilestoneModal);
document.getElementById('milestone-modal').addEventListener('click',e=>{if(e.target.id==='milestone-modal')closeMilestoneModal()});
document.getElementById('mm-save').addEventListener('click',()=>{const name=document.getElementById('mm-name').value.trim();if(!name)return alert('Milestone name required');const projectId=Number(document.getElementById('mm-project').value);if(!projectId)return alert('Select a project');const payload={name,projectId,dueDate:document.getElementById('mm-due').value,status:document.getElementById('mm-status').value,description:document.getElementById('mm-desc').value.trim()};if(editingMilestone){milestones=milestones.map(m=>m.id===editingMilestone?{...m,...payload}:m)}else{milestones.unshift({id:Date.now(),...payload})}persist();closeMilestoneModal();renderMilestones();renderGantt()});

document.getElementById('task-form').addEventListener('submit',e=>{e.preventDefault();if(!projects.length){alert('Create a project first');return}const title=document.getElementById('task-name').value.trim(),dueDate=document.getElementById('task-due').value,projectId=Number(document.getElementById('task-project').value);tasks.unshift({id:Date.now(),title,projectId,dueDate,completed:false,kanbanStatus:'todo'});persist();e.target.reset();renderTasks();renderKanban();renderDashboard();renderSummary();renderProjects()});

document.addEventListener('click',e=>{if(e.target.closest('#new-project-btn-dash')||e.target.closest('#summary-new-btn')||e.target.closest('#projects-new-btn')||e.target.closest('#qa-new-project')){openProjectModal();return}
if(e.target.closest('#milestones-new-btn')||e.target.closest('#qa-new-milestone')){openMilestoneModal();return}
if(e.target.closest('#qa-new-task')){if(!projects.length){alert('Create a project first');return}showPage('tasks');return}
if(e.target.closest('[data-project-edit]')){const card=e.target.closest('.project-item');openProjectModal(Number(card.getAttribute('data-project-id')));return}
if(e.target.closest('[data-project-delete]')){const card=e.target.closest('.project-item'),pid=Number(card.getAttribute('data-project-id')),p=projects.find(x=>x.id===pid);if(!confirm(`Delete project "${p?.name||''}"?\n\nThis will also delete all tasks and milestones.`))return;tasks=tasks.filter(t=>t.projectId!==pid);milestones=milestones.filter(m=>m.projectId!==pid);projects=projects.filter(pr=>pr.id!==pid);if(currentProjectFilter===pid)currentProjectFilter=null;persist();populateProjectDrops();renderDashboard();renderSummary();renderProjects();renderTasks();renderMilestones();renderGantt();return}
if(e.target.closest('[data-action="view-tasks"]')){const card=e.target.closest('.project-item'),pid=Number(card.getAttribute('data-project-id'));currentProjectFilter=pid;const p=projects.find(x=>x.id===pid);if(p){document.getElementById('tasks-subtitle').textContent=`Showing tasks for: ${p.name}`;document.getElementById('clear-filter').style.display='inline-flex'}showPage('tasks');return}
if(e.target.closest('[data-task-edit]')){const card=e.target.closest('.project-item');openTaskModal(Number(card.getAttribute('data-task-id')));return}
if(e.target.closest('[data-task-delete]')){const card=e.target.closest('.project-item'),tid=Number(card.getAttribute('data-task-id')),t=tasks.find(x=>x.id===tid);if(!confirm(`Delete task "${t?.title||''}"?`))return;tasks=tasks.filter(tk=>tk.id!==tid);persist();renderTasks();renderKanban();renderDashboard();renderSummary();renderProjects();return}
if(e.target.closest('[data-milestone-edit]')){const card=e.target.closest('.milestone-item');openMilestoneModal(Number(card.getAttribute('data-milestone-id')));return}
if(e.target.closest('[data-milestone-delete]')){const card=e.target.closest('.milestone-item'),mid=Number(card.getAttribute('data-milestone-id')),m=milestones.find(x=>x.id===mid);if(!confirm(`Delete milestone "${m?.name||''}"?`))return;milestones=milestones.filter(ms=>ms.id!==mid);persist();renderMilestones();renderGantt();return}
if(e.target.closest('[data-milestone-toggle]')){const card=e.target.closest('.milestone-item'),mid=Number(card.getAttribute('data-milestone-id'));milestones=milestones.map(m=>m.id===mid?{...m,status:m.status==='completed'?'pending':'completed'}:m);persist();renderMilestones();renderGantt();return}
if(e.target.classList.contains('filter-btn')&&e.target.hasAttribute('data-filter')){document.querySelectorAll('#summary-filters .filter-btn').forEach(b=>b.classList.remove('active'));e.target.classList.add('active');renderSummary();return}
if(e.target.classList.contains('filter-btn')&&e.target.hasAttribute('data-project-filter')){document.querySelectorAll('#projects-filters .filter-btn').forEach(b=>b.classList.remove('active'));e.target.classList.add('active');renderProjects();return}
if(e.target.classList.contains('filter-btn')&&e.target.hasAttribute('data-task-filter')){document.querySelectorAll('#tasks-filters .filter-btn').forEach(b=>b.classList.remove('active'));e.target.classList.add('active');renderTasks();return}
if(e.target.closest('#clear-completed')){const cnt=tasks.filter(t=>t.completed).length;if(!cnt){alert('No completed tasks');return}if(!confirm(`Clear ${cnt} completed task${cnt>1?'s':''}?`))return;tasks=tasks.filter(t=>!t.completed);persist();renderTasks();renderKanban();renderDashboard();renderSummary();renderProjects();return}
if(e.target.closest('#clear-filter')){currentProjectFilter=null;document.getElementById('tasks-subtitle').textContent='Manage your tasks';document.getElementById('clear-filter').style.display='none';renderTasks();return}});

document.addEventListener('change',e=>{if(e.target.classList.contains('task-check')){const item=e.target.closest('.project-item'),tid=Number(item.getAttribute('data-task-id'));tasks=tasks.map(t=>t.id===tid?{...t,completed:e.target.checked}:t);persist();renderTasks();renderKanban();renderDashboard();renderSummary();renderProjects()}});

function init(){validate();persist();populateProjectDrops();renderDashboard();renderSummary();renderProjects();renderTasks();renderKanban();renderGantt();renderMilestones()}
window.addEventListener('load',init);
</script>
</body>
</html>
